<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>Offerings</title>
</head>
<body>
    <div class="container">
        <!-- Top Section (Login/Sign Up) -->
        <div class="top-section">
            {% if not current_user.is_authenticated %}
                <a href="{{ url_for('login') }}" class="form-button">Login</a>
                <a href="{{ url_for('register') }}" class="form-button">Sign Up</a>
            {% else %}
                <p>Welcome back, {{ current_user.username }}!</p>
                <a href="{{ url_for('logout') }}" class="form-button">Logout</a>
            {% endif %}
        </div>

        <!-- Aesthetic Horizontal Line -->
        <hr class="styled-divider">

        <!-- Admin Section (Create Offering) -->
        {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <div class="admin-section">
                <a href="{{ url_for('create_offering') }}" class="form-button">Create Offering</a>
            </div>
        {% endif %}

        <!-- Bottom Section (Available Offerings) -->
        <div class="bottom-section">
            <h2>Available Offerings</h2>
            <ul>
                {% for offering in offerings %}
                    <li>
                        {{ offering.lesson_type }} at {{ offering.location }} <br>
                        {{ offering.start_time.strftime('%Y-%m-%d %H:%M') }} to {{ offering.end_time.strftime('%Y-%m-%d %H:%M') }} <br>
                        Available spots: {{ offering.available_spots }} / {{ offering.maximum_capacity }}
                        
                        <!-- Check if the offering is available -->
                        {% if offering.available_spots == 0 %}
                            <p class="unavailable-text">Not Available</p>
                        {% else %}
                            <!-- Show the 'Attend' button only for customers -->
                            {% if current_user.is_authenticated and current_user.role == 'customer' %}
                                <!-- Check if the user has already attended the offering -->
                                {% if current_user in offering.attendees %}
                                    <p>You are already attending this offering.</p>
                                {% else %}
                                    <form action="{{ url_for('attend_offering', offering_id=offering.id) }}" method="POST">
                                        <button type="submit" class="form-button">Attend</button>
                                    </form>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </li>
                    <hr>
                {% endfor %}
            </ul>
        </div>
    </div>
</body>
</html>
